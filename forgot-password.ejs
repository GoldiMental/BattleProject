<!DOCTYPE html>
<html lang="DE-de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passwort vergessen? - TulpaKing®</title>
    <link rel="icon" href="img/TulpaIcon.png" type="image/png">
    <link rel="stylesheet" href="Style/login.css">
</head>

<body>
    <!--Background-Section-Beginning-->
    <div class="background-lines">
        <div class="lineRed line-1"></div>
        <div class="lineGold line-2"></div>
        <div class="lineRed line-3"></div>
        <div class="lineGold line-4"></div>
        <div class="lineRed line-5"></div>
        <div class="lineGold line-6"></div>
        <div class="lineRed line-7"></div>
        <div class="lineGold line-8"></div>
        <div class="lineRed line-9"></div>
        <div class="lineGold line-10"></div>
    </div>
    <img id="TulpaIcon" src="img/TulpaIcon.png" alt="TulpaKing-Logo">
    <!--Background-Section-Ending-->
    <div class="main-container">
        <div class="TulpaKingTitle">TulpaKing® - Automatic Support</div>
        <div class="login-container">
            <h2 class="title-text">Ticket: Passwort zurücksetzen</h2>
            <div id="message-container"></div>
            <p>Bitte gib deine verknüpfte E-Mail-Adresse ein.</p>
            <p>Du erhälst in Kürze dann ein Link, womit du ein neues Passwort setzen kannst.</p>
            <form id="forgot-password-form">
                <input type="email" id="email" name="email" placeholder="E-Mail-Adresse" required>
                <button type="submit">Senden</button>
            </form><br>
            <a href="<%= gameServerIP %>" class="back-link">Zurück zur Anmeldung</a>
            <p>Kontakt & Support: <a href="mailto:goldimental@gmx.de">goldimental@gmx.de</a></p>
        </div>
    </div>
    <script lang="js">
        const GAME_SERVER_IP = '<%= gameServerIP %>';
        document.addEventListener('DOMContentLoaded', () => {
            const forgotPasswordForm = document.getElementById('forgot-password-form');
            if (forgotPasswordForm) {
                forgotPasswordForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const email = document.getElementById('email').value;
                    const messageContainer = document.getElementById('message-container');
                    const submitButton = forgotPasswordForm.querySelector('button[type="submit"]');

                    submitButton.disabled = true;
                    submitButton.textContent = 'Sende...';
                    messageContainer.textContent = '';

                    try {
                        let link = GAME_SERVER_IP +"/forgot-password";
                        const response = await fetch(link, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ email })
                        });

                        const data = await response.json();
                        messageContainer.textContent = data.message;
                        submitButton.disabled = true;
                        submitButton.textContent = 'Gesendet';
                        messageContainer.className = 'success-message';
                        console.log(data);

                    } catch (error) {
                        console.error('Fehler:', error);
                        messageContainer.textContent = 'Ein Fehler ist aufgetreten. Bitte versuche es später erneut.';
                        messageContainer.className = 'error-message';
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Link senden';
                    }
                });
            }
        });
    </script>
</body>

</html>